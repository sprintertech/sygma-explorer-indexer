// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Transfer {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  depositNonce  Int            @unique
  resource      Resource?      @relation(fields: [resourceID], references: [id])
  resourceID    String?
  fromDomain    Domain         @relation(name: "fromDomainRelation", fields: [fromDomainId], references: [id])
  fromDomainId  String
  toDomain      Domain?        @relation(name: "toDomainRelation", fields: [toDomainId], references: [id])
  toDomainId    String?
  sender        String?
  destination   String?
  amount        String?
  timestamp     Int?
  status        TransferStatus
  deposit       Deposit?
  execution     Execution?
  fee           Fee?
  addressStatus String?

  @@unique(fields: [depositNonce, fromDomainId], name: "nonceDomain")
}

enum TransferStatus {
  pending
  executed
  failed
}

model Resource {
  id        String     @id @map("_id")
  type      String
  transfers Transfer[]
}

model Domain {
  id   String @id @map("_id")
  name String

  lastIndexedBlock String
  transferFrom     Transfer[] @relation(name: "fromDomainRelation")
  transferTo       Transfer[] @relation(name: "toDomainRelation")
}

model Deposit {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  transfer        Transfer @relation(fields: [transferId], references: [id])
  transferId      String   @unique @db.ObjectId
  type            String
  txHash          String
  blockNumber     String
  depositData     String
  handlerResponse String
}

model Execution {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  transfer    Transfer @relation(fields: [transferId], references: [id])
  transferId  String   @unique @db.ObjectId
  type        String?
  txHash      String
  blockNumber String
}

model Fee {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  amount       String
  tokenAddress String
  tokenSymbol  String
  transfer     Transfer @relation(fields: [transferId], references: [id])
  transferId   String   @unique @db.ObjectId
}