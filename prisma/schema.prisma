// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Transfer {
  id           String         @id @default(auto()) @map("_id") @db.ObjectId
  depositNonce Int            
  resource     Resource?      @relation(fields: [resourceID], references: [id])
  resourceID   String?
  fromDomain   Domain         @relation(name: "fromDomainRelation", fields: [fromDomainId], references: [id])
  fromDomainId Int 
  toDomain     Domain?        @relation(name: "toDomainRelation", fields: [toDomainId], references: [id])
  toDomainId   Int?
  sender       String?
  destination  String?
  amount       String?
  timestamp    DateTime?
  status       TransferStatus
  deposit      Deposit?
  execution    Execution?
  fee          Fee?

  @@unique(fields: [depositNonce, fromDomainId, toDomainId], name: "transferId")
}

enum TransferStatus {
  pending
  executed
  failed
}

model Resource {
  id        String     @id @map("_id")
  type      String
  transfers Transfer[]
}

model Domain {
  id   Int @id @map("_id")
  name String

  lastIndexedBlock String
  transferFrom     Transfer[] @relation(name: "fromDomainRelation")
  transferTo       Transfer[] @relation(name: "toDomainRelation")
}

model Deposit {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  transfer        Transfer @relation(fields: [transferId], references: [id])
  transferId      String   @unique @db.ObjectId
  type            String
  txHash          String
  blockNumber     String
  depositData     String
  handlerResponse String
}

model Execution {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  transfer    Transfer @relation(fields: [transferId], references: [id])
  transferId  String   @unique @db.ObjectId
  txHash      String
  blockNumber String
}

model Fee {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  amount       String
  tokenAddress String
  tokenSymbol  String
  transfer     Transfer @relation(fields: [transferId], references: [id])
  transferId   String   @unique @db.ObjectId
}
